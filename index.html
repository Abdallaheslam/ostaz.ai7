<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  
  <meta charset="utf-8" />
  
  <!-- Meta Viewport Ù…Ø­Ø³Ù† Ù„Ù„Ù‡ÙˆØ§ØªÙ -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, minimum-scale=1, viewport-fit=cover" />
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#6B5BFF" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª Ø§Ù„Ø£Ø³ØªØ§Ø°" />
  <meta name="format-detection" content="telephone=no" />
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† - ØªØ³ÙˆÙ‚ Ø¨Ø³Ù‡ÙˆÙ„Ø© Ù…Ø¹ ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹ Ù„Ø¬Ù…ÙŠØ¹ Ø£Ù†Ø­Ø§Ø¡ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©" />
  <meta name="keywords" content="Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª, ØªØ³ÙˆÙ‚, Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†, ØªÙˆØµÙŠÙ„, Ø¨Ù†Ù‡Ø§, Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©" />
  <meta property="og:title" content="Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª Ø§Ù„Ø£Ø³ØªØ§Ø°" />
  <meta property="og:description" content="Ø£ÙØ¶Ù„ Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ù…Ø¹ ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹" />
  <meta property="og:image" content="./icons/icon-512x512.png" />
  <meta property="og:type" content="website" />
  
  <!-- iOS Specific -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª Ø§Ù„Ø£Ø³ØªØ§Ø°" />
  <link rel="apple-touch-icon" href="./icons/apple-touch-icon.png">
  <link rel="apple-touch-startup-image" href="./icons/apple-splash-2048-2732.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  
  <!-- Windows -->
  <meta name="msapplication-TileColor" content="#6B5BFF" />
  <meta name="msapplication-TileImage" content="./icons/icon-144x144.png" />
  <meta name="msapplication-config" content="browserconfig.xml" />
  
  <title>Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª Ø§Ù„Ø£Ø³ØªØ§Ø° | Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="./manifest.json" crossorigin="use-credentials">
  <link rel="icon" href="./icons/icon-192x192.png" type="image/png" sizes="192x192">
  <link rel="icon" href="./icons/icon-512x512.png" type="image/png" sizes="512x512">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  
  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" integrity="sha512-c42qTSw/wPZ3/5LBzD+Bw5f7bSF2oxou6wEb+I/lqeaKV5FDIfMvvRp772y4jcJLKuGUOpbJMdg/BTl50fJYAw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Store",
    "name": "Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª Ø§Ù„Ø£Ø³ØªØ§Ø°",
    "description": "Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ù„Ù„ØªØ³ÙˆÙ‚ Ù…Ø¹ ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹",
    "url": "https://supermarket-alostaz.web.app",
    "telephone": "+201550462808",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "Ø´Ø§Ø±Ø¹ Ø¹Ø¨Ø¯Ø§Ù„Ø­Ø§ÙØ¸",
      "addressLocality": "Ø¨Ù†Ù‡Ø§",
      "addressRegion": "Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©",
      "addressCountry": "EG"
    },
    "openingHours": "Mo-Su 08:00-24:00",
    "priceRange": "$$"
  }
  </script>

  <!-- ====== CSS Ù…Ø¶Ù…Ù‘Ù† Ù…Ø¹ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù‡ÙˆØ§ØªÙ ====== -->
  <style>
    /* ====== CSS RESET & BASE STYLES ====== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    :root {
      --primary-gradient: linear-gradient(135deg, #6B5BFF 0%, #7C64FF 100%);
      --primary-color: #6B5BFF;
      --primary-dark: #5A4BFF;
      --primary-light: #8C7CFF;
      --search-orange: #FFA500;
      --browse-orange: #FF7F00;
      --coupon-purple: #6B5BFF;
      --cart-red: #FF2D55;
      --phone-orange: #FF9500;
      --whatsapp-green: #25D366;
      --bg-color: #FFFFFF;
      --text-primary: #333333;
      --text-secondary: #666666;
      --text-light: #999999;
      --card-bg: #ffffff;
      --border-color: #e0e0e0;
      --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.12);
      --shadow-lg: 0 8px 24px rgba(0,0,0,0.16);
      --border-radius-sm: 8px;
      --border-radius-md: 12px;
      --border-radius-lg: 16px;
      --transition-fast: 0.2s ease;
      --transition-normal: 0.3s ease;
      --transition-slow: 0.5s ease;
      --navbar-height: 60px;
      --bottom-nav-height: 70px;
      --safe-area-top: env(safe-area-inset-top, 0px);
      --safe-area-bottom: env(safe-area-inset-bottom, 0px);
      --safe-area-left: env(safe-area-inset-left, 0px);
      --safe-area-right: env(safe-area-inset-right, 0px);
    }
    
    html {
      scroll-behavior: smooth;
      font-size: 16px;
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
    }
    
    body {
      font-family: 'Cairo', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-primary);
      line-height: 1.6;
      direction: rtl;
      overflow-x: hidden;
      padding-bottom: calc(var(--bottom-nav-height) + var(--safe-area-bottom));
      min-height: 100vh;
      padding-top: var(--safe-area-top);
    }
    
    /* ====== ØªØ­Ø³ÙŠÙ†Ø§Øª Touch Ù„Ù„Ù‡ÙˆØ§ØªÙ ====== */
    @media (hover: none) and (pointer: coarse) {
      input,
      textarea,
      button,
      select,
      a {
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        min-height: 44px;
        min-width: 44px;
      }
      
      button:active {
        transform: scale(0.98);
      }
    }
    
    /* ====== TYPOGRAPHY ====== */
    h1, h2, h3, h4, h5, h6 {
      font-weight: 700;
      line-height: 1.3;
      color: var(--text-primary);
    }
    
    h1 { font-size: clamp(1.5rem, 5vw, 2rem); }
    h2 { font-size: clamp(1.25rem, 4vw, 1.75rem); }
    h3 { font-size: clamp(1.125rem, 3vw, 1.5rem); }
    h4 { font-size: clamp(1rem, 2.5vw, 1.25rem); }
    
    p {
      margin-bottom: 1rem;
      color: var(--text-secondary);
    }
    
    a {
      color: var(--primary-color);
      text-decoration: none;
      transition: color var(--transition-fast);
    }
    
    a:focus-visible {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
      border-radius: 4px;
    }
    
    /* ====== BUTTONS Ù…Ø­Ø³Ù†Ø© Ù„Ù„Ù‡ÙˆØ§ØªÙ ====== */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 24px;
      border: none;
      border-radius: var(--border-radius-md);
      font-family: inherit;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all var(--transition-normal);
      min-height: 44px;
      min-width: 44px;
      position: relative;
      overflow: hidden;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
    }
    
    .btn:active {
      transform: translateY(1px);
    }
    
    .btn:focus-visible {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
    }
    
    .btn-primary {
      background: var(--primary-gradient);
      color: white;
      box-shadow: var(--shadow-sm);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, var(--browse-orange), #FF8C00);
      color: white;
      box-shadow: var(--shadow-sm);
    }
    
    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }
    
    .btn-orange {
      background: linear-gradient(135deg, #FF9500, #FFA500);
      color: white;
    }
    
    .btn-orange:hover {
      background: linear-gradient(135deg, #FF7F00, #FF9500);
    }
    
    .btn-coupon {
      background: linear-gradient(135deg, var(--coupon-purple), var(--primary-light));
      color: white;
    }
    
    .btn-search {
      background: var(--search-orange);
      color: white;
    }
    
    .btn-success {
      background: linear-gradient(135deg, var(--whatsapp-green), #4CD964);
      color: white;
    }
    
    .btn-danger {
      background: linear-gradient(135deg, var(--cart-red), #FF4757);
      color: white;
    }
    
    .btn-warning {
      background: linear-gradient(135deg, var(--phone-orange), #FFAA33);
      color: white;
    }
    
    .btn-outline {
      background: transparent;
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
    }
    
    .btn-outline:hover {
      background: var(--primary-color);
      color: white;
    }
    
    /* ====== NAVBAR Ù…Ø­Ø³Ù† ====== */
    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: calc(var(--navbar-height) + var(--safe-area-top));
      background: var(--primary-gradient);
      color: white;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(107, 91, 255, 0.15);
      display: flex;
      align-items: center;
      padding: 0 max(15px, var(--safe-area-right));
      padding-top: var(--safe-area-top);
      transition: all var(--transition-normal);
    }
    
    .navbar-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      gap: 10px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      flex-shrink: 0;
      min-width: 0;
    }
    
    .logo-icon {
      width: 36px;
      height: 36px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    
    .logo-text {
      font-size: clamp(0.9rem, 3vw, 1.1rem);
      font-weight: 800;
      color: white;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* ====== SEARCH BAR ====== */
    .search-container {
      flex: 1;
      min-width: 0;
      max-width: 400px;
      margin: 0 10px;
    }
    
    .search-box {
      display: flex;
      background: white;
      border-radius: var(--border-radius-md);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
      height: 42px;
    }
    
    .search-input {
      flex: 1;
      padding: 10px 15px;
      border: none;
      font-family: inherit;
      font-size: 0.95rem;
      color: var(--text-primary);
      min-width: 0;
      background: transparent;
    }
    
    .search-input:focus {
      outline: none;
    }
    
    .search-button {
      padding: 0 15px;
      background: var(--search-orange);
      color: white;
      border: none;
      cursor: pointer;
      min-width: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* ====== BOTTOM NAVIGATION Ù…Ø¹ Safe Area ====== */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: calc(var(--bottom-nav-height) + var(--safe-area-bottom));
      background: white;
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: space-around;
      align-items: flex-start;
      z-index: 999;
      padding-bottom: var(--safe-area-bottom);
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 8px;
      color: var(--text-light);
      text-decoration: none;
      transition: all var(--transition-fast);
      position: relative;
      flex: 1;
      max-width: 80px;
      min-height: 60px;
    }
    
    .nav-item.active {
      color: var(--primary-color);
    }
    
    .nav-item.active .nav-icon {
      background: var(--primary-gradient);
      color: white;
      transform: translateY(-5px);
    }
    
    .nav-icon {
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(107, 91, 255, 0.1);
      border-radius: 50%;
      font-size: 1.2rem;
      transition: all var(--transition-normal);
    }
    
    .nav-badge {
      position: absolute;
      top: 2px;
      left: 50%;
      background: var(--cart-red);
      color: white;
      font-size: 0.7rem;
      min-width: 18px;
      height: 18px;
      border-radius: 9px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 4px;
      font-weight: 700;
    }
    
    /* ====== MAIN CONTENT Ù…Ø¹ Safe Area ====== */
    .main-content {
      padding: calc(var(--navbar-height) + var(--safe-area-top) + 20px) max(20px, var(--safe-area-right)) 30px max(20px, var(--safe-area-left));
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }
    
    /* ====== HERO SECTION ====== */
    .hero-section {
      background: var(--primary-gradient);
      border-radius: var(--border-radius-lg);
      padding: 30px 20px;
      color: white;
      margin-bottom: 25px;
      position: relative;
      overflow: hidden;
    }
    
    .hero-content {
      position: relative;
      z-index: 1;
      text-align: center;
    }
    
    /* ====== CATEGORIES & PRODUCTS ====== */
    .section {
      background: var(--card-bg);
      border-radius: var(--border-radius-lg);
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
    }
    
    .categories-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 15px;
    }
    
    .category-card {
      background: var(--card-bg);
      border-radius: var(--border-radius-md);
      padding: 15px;
      text-align: center;
      text-decoration: none;
      color: var(--text-primary);
      transition: all var(--transition-normal);
      border: 1px solid var(--border-color);
    }
    
    .category-card:active {
      transform: scale(0.98);
    }
    
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 15px;
    }
    
    .product-card {
      background: var(--card-bg);
      border-radius: var(--border-radius-md);
      overflow: hidden;
      position: relative;
      transition: all var(--transition-normal);
      border: 1px solid var(--border-color);
    }
    
    .product-card:active {
      transform: translateY(2px);
    }
    
    .product-image {
      width: 100%;
      height: 160px;
      object-fit: contain;
      background: rgba(107, 91, 255, 0.05);
      padding: 15px;
    }
    
    /* ====== ADMIN PANEL Ù…Ø­Ø³Ù† ====== */
    .admin-panel {
      background: white;
      border-radius: var(--border-radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-lg);
    }
    
    .admin-header {
      background: var(--primary-gradient);
      color: white;
      padding: 20px;
    }
    
    .admin-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 15px;
      padding: 20px;
      background: rgba(107, 91, 255, 0.05);
    }
    
    .stat-card {
      background: white;
      border-radius: var(--border-radius-md);
      padding: 15px;
      text-align: center;
      border: 1px solid var(--border-color);
    }
    
    .admin-tabs {
      display: flex;
      background: rgba(107, 91, 255, 0.05);
      padding: 0 20px;
      border-bottom: 1px solid var(--border-color);
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    .admin-tab {
      padding: 12px 20px;
      background: none;
      border: none;
      color: var(--text-secondary);
      font-family: inherit;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      min-height: 44px;
    }
    
    .admin-tab.active {
      color: var(--primary-color);
      position: relative;
    }
    
    .admin-tab.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--primary-gradient);
    }
    
    .admin-content {
      padding: 20px;
      min-height: 300px;
    }
    
    /* ====== MODALS Ù…Ø¹ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù‡ÙˆØ§ØªÙ ====== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 20px;
      backdrop-filter: blur(5px);
    }
    
    .modal {
      background: white;
      border-radius: var(--border-radius-lg);
      width: 100%;
      max-width: 500px;
      max-height: 80vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    .modal-body {
      padding: 20px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      flex: 1;
    }
    
    .modal-footer {
      padding: 15px 20px;
      border-top: 1px solid var(--border-color);
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }
    
    /* ====== FORM ØªØ­Ø³ÙŠÙ†Ø§Øª ====== */
    .form-control {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-md);
      font-family: inherit;
      font-size: 1rem;
      transition: all var(--transition-fast);
      background: white;
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(107, 91, 255, 0.1);
    }
    
    /* ====== CART ØªØ­Ø³ÙŠÙ†Ø§Øª ====== */
    .cart-item {
      display: flex;
      gap: 15px;
      padding: 15px;
      border-bottom: 1px solid var(--border-color);
      align-items: center;
    }
    
    .quantity-control {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(107, 91, 255, 0.05);
      border-radius: var(--border-radius-md);
      padding: 5px;
    }
    
    .quantity-btn {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: none;
      background: white;
      color: var(--text-primary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
    }
    
    /* ====== ANIMATIONS ====== */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
      100% {
        transform: scale(1);
      }
    }
    
    /* ====== LOADING STATES ====== */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 200px;
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(107, 91, 255, 0.2);
      border-top-color: var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    /* ====== UTILITY CLASSES ====== */
    .text-center { text-align: center; }
    .text-right { text-align: right; }
    .text-left { text-align: left; }
    .text-primary { color: var(--primary-color); }
    .text-success { color: var(--whatsapp-green); }
    .text-danger { color: var(--cart-red); }
    .text-warning { color: var(--phone-orange); }
    .text-muted { color: var(--text-light); }
    
    .mb-1 { margin-bottom: 8px; }
    .mb-2 { margin-bottom: 16px; }
    .mb-3 { margin-bottom: 24px; }
    .mb-4 { margin-bottom: 32px; }
    
    .mt-1 { margin-top: 8px; }
    .mt-2 { margin-top: 16px; }
    .mt-3 { margin-top: 24px; }
    .mt-4 { margin-top: 32px; }
    
    .d-flex { display: flex; }
    .d-none { display: none; }
    
    .align-items-center { align-items: center; }
    .justify-content-between { justify-content: space-between; }
    .justify-content-center { justify-content: center; }
    
    .gap-1 { gap: 8px; }
    .gap-2 { gap: 16px; }
    .gap-3 { gap: 24px; }
    
    .w-100 { width: 100%; }
    .h-100 { height: 100%; }
    
    .position-relative { position: relative; }
    .position-absolute { position: absolute; }
    
    .rounded { border-radius: var(--border-radius-md); }
    .rounded-circle { border-radius: 50%; }
    
    .shadow-sm { box-shadow: var(--shadow-sm); }
    .shadow-md { box-shadow: var(--shadow-md); }
    .shadow-lg { box-shadow: var(--shadow-lg); }
    
    /* ====== RESPONSIVE DESIGN ====== */
    @media (max-width: 768px) {
      :root {
        --navbar-height: 56px;
        --bottom-nav-height: 65px;
      }
      
      .navbar {
        padding: 0 10px;
        padding-top: var(--safe-area-top);
      }
      
      .search-container {
        display: none;
      }
      
      .mobile-search-btn {
        display: flex;
      }
      
      .hero-section {
        padding: 25px 15px;
      }
      
      .section {
        padding: 15px;
      }
      
      .categories-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .products-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .admin-stats {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .modal {
        margin: 0;
        border-radius: 0;
        max-height: 100vh;
        height: 100vh;
      }
      
      .modal-overlay {
        padding: 0;
      }
    }
    
    @media (max-width: 480px) {
      .categories-grid {
        grid-template-columns: 1fr;
      }
      
      .products-grid {
        grid-template-columns: 1fr;
      }
      
      .admin-stats {
        grid-template-columns: 1fr;
      }
      
      .admin-tab {
        padding: 10px 15px;
        font-size: 0.9rem;
      }
      
      .hero-actions {
        flex-direction: column;
      }
      
      .hero-actions .btn {
        width: 100%;
      }
    }
    
    @media (max-width: 360px) {
      .logo-text {
        font-size: 0.85rem;
      }
      
      .nav-icon {
        width: 40px;
        height: 40px;
        font-size: 1rem;
      }
      
      .nav-label {
        font-size: 0.7rem;
      }
    }
    
    /* ====== PWA SPECIFIC STYLES ====== */
    @media (display-mode: standalone) {
      body {
        padding-top: env(safe-area-inset-top);
        padding-bottom: calc(var(--bottom-nav-height) + env(safe-area-inset-bottom));
      }
      
      .navbar {
        padding-top: env(safe-area-inset-top);
        height: calc(var(--navbar-height) + env(safe-area-inset-top));
      }
      
      .bottom-nav {
        padding-bottom: env(safe-area-inset-bottom);
        height: calc(var(--bottom-nav-height) + env(safe-area-inset-bottom));
      }
      
      /* Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ PWA */
      .modal-overlay {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
      }
    }
    
    /* ØªØ­Ø³ÙŠÙ† Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªÙ…Ø±ÙŠØ± */
    .modal-body,
    .admin-content {
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
    }
    
    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù„Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª */
    .product-card,
    .category-card,
    .btn {
      will-change: transform;
    }
    
    /* Ù…Ù†Ø¹ zoom ØºÙŠØ± Ù…Ø±ØºÙˆØ¨ ÙÙŠÙ‡ Ø¹Ù„Ù‰ iOS */
    @supports (-webkit-touch-callout: none) {
      input,
      textarea,
      select {
        font-size: 16px !important;
      }
    }
    
    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø´Ø§Ø´Ø§Øª Ù…Ø¹ Notch */
    @media (orientation: landscape) {
      .modal {
        max-height: 90vh;
      }
    }
  </style>
  
</head>
<body>

  <!-- Top Navbar -->
  <nav class="navbar" id="navbar">
    <div class="navbar-container">
      <!-- Logo -->
      <div class="logo" onclick="goHome()">
        <div class="logo-icon">
          <i class="fas fa-store"></i>
        </div>
        <div class="logo-text">Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª Ø§Ù„Ø£Ø³ØªØ§Ø°</div>
      </div>
      
      <!-- Ø²Ø± Ø§Ù„Ø¨Ø­Ø« Ù„Ù„Ù‡ÙˆØ§ØªÙ -->
      <button class="mobile-search-btn btn btn-search" onclick="toggleMobileSearch()">
        <i class="fas fa-search"></i>
      </button>
      
      <!-- Search Bar -->
      <div class="search-container">
        <div class="search-box">
          <input type="text" class="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...">
          <button class="search-button">
            <i class="fas fa-search"></i>
          </button>
        </div>
      </div>
      
      <!-- Auth Buttons -->
      <div class="auth-buttons" id="authButtons">
        <button class="btn btn-primary btn-sm" onclick="openLoginModal()">
          <i class="fas fa-sign-in-alt"></i>
          <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
        </button>
        <button class="btn btn-orange btn-sm" onclick="openRegisterModal()">
          <i class="fas fa-user-plus"></i>
          <span>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</span>
        </button>
      </div>
      
      <!-- User Profile -->
      <div class="user-profile" id="userProfile" style="display: none;">
        <img src="https://ui-avatars.com/api/?name=Ù…Ø³ØªØ®Ø¯Ù…&background=6B5BFF&color=fff&size=64" 
             alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" 
             class="user-avatar"
             id="userAvatar">
        <div class="user-dropdown">
          <a href="#" class="dropdown-item" onclick="openProfile()">
            <i class="fas fa-user"></i>
            <span>Ø­Ø³Ø§Ø¨ÙŠ</span>
          </a>
          <a href="#" class="dropdown-item" onclick="openOrders()">
            <i class="fas fa-shopping-bag"></i>
            <span>Ø·Ù„Ø¨Ø§ØªÙŠ</span>
          </a>
          <a href="#" class="dropdown-item" onclick="openWishlist()">
            <i class="fas fa-heart"></i>
            <span>Ø§Ù„Ù…ÙØ¶Ù„Ø©</span>
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item" onclick="logoutUser()" style="color: var(--cart-red);">
            <i class="fas fa-sign-out-alt"></i>
            <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Ø¨Ø­Ø« Ø§Ù„Ù‡ÙˆØ§ØªÙ -->
  <div class="mobile-search-container" id="mobileSearch" style="display: none;">
    <div class="search-box">
      <input type="text" class="search-input" id="mobileSearchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...">
      <button class="search-button" onclick="searchFromMobile()">
        <i class="fas fa-search"></i>
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <main class="main-content" id="mainContent">
    <!-- Hero Section -->
    <section class="hero-section">
      <div class="hero-content">
        <h1 class="hero-title animate__animated animate__fadeInDown">ğŸ‰ Ø¹Ø±ÙˆØ¶ 2026 Ø§Ù„Ø­ØµØ±ÙŠØ© ğŸ‰</h1>
        <p class="hero-subtitle animate__animated animate__fadeInUp">Ø®ØµÙˆÙ…Ø§Øª ØªØµÙ„ Ø¥Ù„Ù‰ 50% Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª | ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù„Ø·Ù„Ø¨Ø§Øª ÙÙˆÙ‚ 300 Ø¬Ù†ÙŠÙ‡</p>
        <div class="hero-actions animate__animated animate__fadeInUp">
          <button class="btn btn-secondary btn-lg" onclick="showOffersPage()">
            <i class="fas fa-percentage"></i>
            ØªØµÙØ­ Ø§Ù„Ø¹Ø±ÙˆØ¶
          </button>
          <button class="btn btn-coupon btn-lg" onclick="openCouponModal()">
            <i class="fas fa-tag"></i>
            Ø§Ø³ØªØ®Ø¯Ù… ÙƒÙˆØ¨ÙˆÙ†
          </button>
        </div>
      </div>
    </section>

    <!-- Categories Section -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-tags"></i>
          ØªØµÙØ­ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
        </h2>
        <a href="#" class="view-all" onclick="showCategoriesPage()">
          Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
          <i class="fas fa-arrow-left"></i>
        </a>
      </div>
      <div class="categories-grid" id="categoriesContainer">
        <!-- Categories will be loaded here -->
      </div>
    </section>

    <!-- Offers Section -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-fire"></i>
          Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø®Ø§ØµØ©
        </h2>
        <a href="#" class="view-all" onclick="showOffersPage()">
          Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
          <i class="fas fa-arrow-left"></i>
        </a>
      </div>
      <div class="products-grid" id="offersContainer">
        <!-- Offers will be loaded here -->
      </div>
    </section>

    <!-- Featured Products -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-star"></i>
          Ù…Ù†ØªØ¬Ø§Øª Ù…Ù…ÙŠØ²Ø©
        </h2>
        <a href="#" class="view-all" onclick="showAllProductsPage()">
          Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
          <i class="fas fa-arrow-left"></i>
        </a>
      </div>
      <div class="products-grid" id="featuredContainer">
        <!-- Featured products will be loaded here -->
      </div>
    </section>

    <!-- New Products -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-bolt"></i>
          Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
        </h2>
        <a href="#" class="view-all" onclick="showAllProductsPage()">
          Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
          <i class="fas fa-arrow-left"></i>
        </a>
      </div>
      <div class="products-grid" id="newProductsContainer">
        <!-- New products will be loaded here -->
      </div>
    </section>
  </main>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <a href="#" class="nav-item active" onclick="goHome(); setActiveNav(this);">
      <div class="nav-icon">
        <i class="fas fa-home"></i>
      </div>
      <span class="nav-label">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </a>
    
    <a href="#" class="nav-item" onclick="showAllProductsPage(); setActiveNav(this);">
      <div class="nav-icon">
        <i class="fas fa-shopping-bag"></i>
      </div>
      <span class="nav-label">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
    </a>
    
    <a href="#" class="nav-item" onclick="showCategoriesPage(); setActiveNav(this);">
      <div class="nav-icon">
        <i class="fas fa-tags"></i>
      </div>
      <span class="nav-label">Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</span>
    </a>
    
    <a href="#" class="nav-item" onclick="showOffersPage(); setActiveNav(this);">
      <div class="nav-icon">
        <i class="fas fa-percentage"></i>
      </div>
      <span class="nav-label">Ø§Ù„Ø¹Ø±ÙˆØ¶</span>
    </a>
    
    <a href="#" class="nav-item" onclick="openCart(); setActiveNav(this);">
      <div class="nav-icon">
        <i class="fas fa-shopping-cart"></i>
      </div>
      <span class="nav-label">Ø§Ù„Ø¹Ø±Ø¨Ø©</span>
      <span class="nav-badge" id="cartBadge">0</span>
    </a>
    
    <a href="#" class="nav-item" onclick="openWishlist(); setActiveNav(this);">
      <div class="nav-icon">
        <i class="fas fa-heart"></i>
      </div>
      <span class="nav-label">Ø§Ù„Ù…ÙØ¶Ù„Ø©</span>
      <span class="nav-badge" id="favoritesBottomBadge" style="display: none;">0</span>
    </a>
    
    <a href="#" class="nav-item" onclick="openNotifications(); setActiveNav(this);">
      <div class="nav-icon">
        <i class="fas fa-bell"></i>
      </div>
      <span class="nav-label">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span>
      <span class="nav-badge" id="notifBadge">0</span>
    </a>
  </nav>

  <!-- Modals Container -->
  <div id="modalsContainer"></div>

  <!-- Admin Floating Button -->
  <button id="adminFloatBtn" class="btn btn-primary" style="
    position: fixed;
    bottom: calc(90px + var(--safe-area-bottom));
    left: max(20px, var(--safe-area-left));
    width: 56px;
    height: 56px;
    border-radius: 50%;
    z-index: 998;
    display: none;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-lg);
  " onclick="openAdminPanel()" title="Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…">
    <i class="fas fa-tools"></i>
  </button>

  <!-- WhatsApp Floating Button -->
  <button id="whatsappFloatBtn" class="btn btn-success" style="
    position: fixed;
    bottom: calc(160px + var(--safe-area-bottom));
    left: max(20px, var(--safe-area-left));
    width: 56px;
    height: 56px;
    border-radius: 50%;
    z-index: 998;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-lg);
  " onclick="openWhatsapp()" title="ÙˆØ§ØªØ³Ø§Ø¨">
    <i class="fab fa-whatsapp"></i>
  </button>

  <!-- Phone Floating Button -->
  <button id="phoneFloatBtn" class="btn btn-warning" style="
    position: fixed;
    bottom: calc(230px + var(--safe-area-bottom));
    left: max(20px, var(--safe-area-left));
    width: 56px;
    height: 56px;
    border-radius: 50%;
    z-index: 998;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-lg);
  " onclick="openPhone()" title="Ø§ØªØµÙ„ Ø¨Ù†Ø§">
    <i class="fas fa-phone"></i>
  </button>

  <!-- Firebase SDKs -->
  <script defer src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.6.10/firebase-analytics-compat.js"></script>

  <!-- JavaScript Application Code -->
  <script>
  /**************************************************************************
   * ØªØ·Ø¨ÙŠÙ‚ Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª Ø§Ù„Ø£Ø³ØªØ§Ø° - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
   * Ø¥ØµØ¯Ø§Ø± 2026.3 - PWA Ø§Ø­ØªØ±Ø§ÙÙŠ 100% Ù„Ù„Ù‡ÙˆØ§ØªÙ
   **************************************************************************/

  // ---------- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ----------
  const APP_CONFIG = {
    name: 'Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª Ø§Ù„Ø£Ø³ØªØ§Ø°',
    version: '2026.3',
    firebase: {
      apiKey: "AIzaSyAX2wKpYXUYmEA-Yn-W88BoMbzbD24HlEE",
      authDomain: "supermarket-3aboda.firebaseapp.com",
      projectId: "supermarket-3aboda",
      storageBucket: "supermarket-3aboda.firebasestorage.app",
      messagingSenderId: "451841595000",
      appId: "1:451841595000:web:69ed544e1692ff09947f8d",
      measurementId: "G-SEJZSP24P1"
    },
    whatsapp: "201550462808",
    phone: "01550462808",
    address: "Ø´Ø§Ø±Ø¹ Ø¹Ø¨Ø¯Ø§Ù„Ø­Ø§ÙØ¸ØŒ Ø¨Ù†Ù‡Ø§ØŒ Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©"
  };

  // ---------- ØªÙ‡ÙŠØ¦Ø© Firebase ----------
  let db, auth, storage;
  
  try {
    if (firebase.apps.length === 0) {
      firebase.initializeApp(APP_CONFIG.firebase);
    }
    db = firebase.firestore();
    auth = firebase.auth();
    storage = firebase.storage();
    
    if (APP_CONFIG.firebase.measurementId) {
      try { firebase.analytics(); } catch(e) { console.log('Analytics disabled'); }
    }
  } catch (error) {
    console.error('Firebase initialization error:', error);
  }

  // ---------- Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ----------
  let currentUser = null;
  let userData = null;
  let globalProducts = [];
  let cart = JSON.parse(localStorage.getItem('cart') || '[]');
  let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
  let notifications = [];

  // ---------- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ----------
  document.addEventListener('DOMContentLoaded', async () => {
    console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª Ø§Ù„Ø£Ø³ØªØ§Ø°');
    
    // ØªØ­Ø³ÙŠÙ† UX Ù„Ù„Ù‡ÙˆØ§ØªÙ
    improveMobileUX();
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    setupAuth();
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    await loadInitialData();
    
    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    updateUI();
    
    // ØªØ³Ø¬ÙŠÙ„ Service Worker
    registerServiceWorker();
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    setupEventListeners();
    
    // ØªØ­Ø³ÙŠÙ† Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    optimizePerformance();
    
    console.log('âœ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…');
    
    // Ø¥Ø¸Ù‡Ø§Ø± ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
    setTimeout(showInstallPrompt, 5000);
  });

  // ---------- ØªØ­Ø³ÙŠÙ† UX Ù„Ù„Ù‡ÙˆØ§ØªÙ ----------
  function improveMobileUX() {
    // Ù…Ù†Ø¹ Ø§Ù„Ø²ÙˆÙ… Ø§Ù„ØºÙŠØ± Ù…Ø±ØºÙˆØ¨ ÙÙŠÙ‡ Ø¹Ù„Ù‰ iOS
    document.addEventListener('touchstart', function(event) {
      if (event.touches.length > 1) {
        event.preventDefault();
      }
    }, { passive: false });
    
    // Ø¥ØµÙ„Ø§Ø­ Ø§Ø±ØªÙØ§Ø¹ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø¹Ù„Ù‰ iOS
    const inputs = document.querySelectorAll('input, textarea, select');
    inputs.forEach(input => {
      input.addEventListener('focus', () => {
        setTimeout(() => {
          document.activeElement.scrollIntoView({
            behavior: 'smooth',
            block: 'center'
          });
        }, 300);
      });
    });
    
    // ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¹Ù„Ù‰ iOS
    document.body.style.WebkitOverflowScrolling = 'touch';
  }

  // ---------- ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ ----------
  function optimizePerformance() {
    // Lazy loading Ù„Ù„ØµÙˆØ±
    const images = document.querySelectorAll('img[data-src]');
    const imageObserver = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const img = entry.target;
          img.src = img.dataset.src;
          img.removeAttribute('data-src');
          observer.unobserve(img);
        }
      });
    });
    
    images.forEach(img => imageObserver.observe(img));
    
    // Debounce Ù„Ù„Ø£Ø­Ø¯Ø§Ø«
    window.addEventListener('resize', debounce(handleResize, 250));
  }

  function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }

  function handleResize() {
    updateUI();
  }

  // ---------- PWA Installation Prompt ----------
  let deferredPrompt;
  
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
  });

  function showInstallPrompt() {
    if (deferredPrompt && isMobile()) {
      setTimeout(() => {
        if (confirm('Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ ØªØ«Ø¨ÙŠØª ØªØ·Ø¨ÙŠÙ‚ Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¹Ù„Ù‰ Ù‡Ø§ØªÙÙƒØŸ')) {
          deferredPrompt.prompt();
          deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === 'accepted') {
              console.log('ØªÙ… Ù‚Ø¨ÙˆÙ„ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚');
            } else {
              console.log('ØªÙ… Ø±ÙØ¶ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚');
            }
            deferredPrompt = null;
          });
        }
      }, 1000);
    }
  }

  function isMobile() {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
  }

  // ---------- Service Worker Registration ----------
  async function registerServiceWorker() {
    if ('serviceWorker' in navigator) {
      try {
        const registration = await navigator.serviceWorker.register('./sw.js', {
          scope: '/',
          updateViaCache: 'none'
        });
        
        console.log('âœ… Service Worker registered:', registration.scope);
        
        // Check for updates
        registration.addEventListener('updatefound', () => {
          const newWorker = registration.installing;
          newWorker.addEventListener('statechange', () => {
            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
              if (confirm('ÙŠØªÙˆÙØ± ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯. Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŸ')) {
                window.location.reload();
              }
            }
          });
        });
        
        // Handle messages from SW
        navigator.serviceWorker.addEventListener('message', event => {
          if (event.data.type === 'NEW_CONTENT_AVAILABLE') {
            showNotification('ÙŠØªÙˆÙØ± ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯', 'info');
          }
        });
        
      } catch (error) {
        console.error('âŒ Service Worker registration failed:', error);
      }
    }
  }

  // ---------- Two-way Data Binding Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª ----------
  function createReactiveStore() {
    const store = {
      cart: cart,
      favorites: favorites,
      user: userData,
      products: globalProducts
    };
    
    const handlers = new Map();
    
    return new Proxy(store, {
      set(target, property, value) {
        const oldValue = target[property];
        target[property] = value;
        
        // Save to localStorage if needed
        if (property === 'cart') {
          localStorage.setItem('cart', JSON.stringify(value));
          updateCartBadge();
        } else if (property === 'favorites') {
          localStorage.setItem('favorites', JSON.stringify(value));
          updateFavoritesBadge();
        }
        
        // Notify listeners
        if (handlers.has(property)) {
          handlers.get(property).forEach(handler => handler(value, oldValue));
        }
        
        return true;
      },
      get(target, property) {
        return target[property];
      }
    });
  }

  // Create reactive store
  const store = createReactiveStore();

  // ---------- Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ----------
  function setupAuth() {
    if (!auth) {
      console.error('Firebase Auth not initialized');
      return;
    }
    
    auth.onAuthStateChanged(async (user) => {
      currentUser = user;
      
      if (user) {
        // Load user data
        try {
          const userDoc = await db.collection('users').doc(user.uid).get();
          
          if (userDoc.exists) {
            userData = userDoc.data();
            store.user = userData;
          } else {
            // Create new user
            userData = {
              name: user.displayName || user.email?.split('@')[0] || 'Ù…Ø³ØªØ®Ø¯Ù…',
              email: user.email,
              phone: '',
              address: '',
              role: 'customer',
              createdAt: firebase.firestore.FieldValue.serverTimestamp(),
              photoURL: user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || user.email)}&background=6B5BFF&color=fff&size=64`
            };
            
            await db.collection('users').doc(user.uid).set(userData);
            store.user = userData;
            
            // Notify admins
            notifyAdminsNewUser(user.uid, userData.name, user.email);
          }
          
          // Update UI
          updateUserProfile();
          
          // Show admin button if admin
          if (userData.role === 'admin') {
            document.getElementById('adminFloatBtn').style.display = 'flex';
          }
          
          // Load notifications
          await loadNotifications();
          
          // Update auth UI
          document.getElementById('authButtons').style.display = 'none';
          document.getElementById('userProfile').style.display = 'flex';
          
        } catch (error) {
          console.error('Error loading user data:', error);
          showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
        }
        
      } else {
        userData = null;
        store.user = null;
        document.getElementById('adminFloatBtn').style.display = 'none';
        document.getElementById('authButtons').style.display = 'flex';
        document.getElementById('userProfile').style.display = 'none';
      }
      
      updateUI();
    });
  }

  // ---------- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© ----------
  async function loadInitialData() {
    try {
      // Load categories
      await loadCategories();
      
      // Load products
      await loadProducts();
      
      // Update badges
      updateCartBadge();
      updateFavoritesBadge();
      
    } catch (error) {
      console.error('Error loading initial data:', error);
      showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
    }
  }

  // ---------- Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ----------
  function showNotification(message, type = 'info') {
    // Remove existing notifications
    const existingNotifications = document.querySelectorAll('.custom-notification');
    existingNotifications.forEach(notif => notif.remove());
    
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `custom-notification ${type}`;
    
    const colors = {
      success: '#25D366',
      error: '#FF2D55',
      warning: '#FF9500',
      info: '#6B5BFF'
    };
    
    notification.innerHTML = `
      <div style="
        position: fixed;
        top: calc(var(--navbar-height) + var(--safe-area-top) + 20px);
        right: 20px;
        left: 20px;
        background: ${colors[type] || '#6B5BFF'};
        color: white;
        padding: 15px 20px;
        border-radius: var(--border-radius-md);
        z-index: 9999;
        box-shadow: var(--shadow-lg);
        animation: slideInDown 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
      ">
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
        <span>${message}</span>
      </div>
    `;
    
    document.body.appendChild(notification);
    
    // Remove after 3 seconds
    setTimeout(() => {
      notification.style.animation = 'slideOutUp 0.3s ease';
      setTimeout(() => notification.remove(), 300);
    }, 3000);
    
    // Add animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideInDown {
        from {
          transform: translateY(-100%);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      @keyframes slideOutUp {
        from {
          transform: translateY(0);
          opacity: 1;
        }
        to {
          transform: translateY(-100%);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(style);
  }

  // ---------- Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ù„Ø© ----------
  function addToCart(productId, button = null) {
    const product = globalProducts.find(p => p.id === productId);
    if (!product) {
      showNotification('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
      return;
    }
    
    if (product.stock === 0) {
      showNotification('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹', 'warning');
      return;
    }
    
    const existingItem = cart.find(item => item.id === productId);
    
    if (existingItem) {
      if (product.stock && existingItem.quantity >= product.stock) {
        showNotification(`Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø£ÙƒØ«Ø± Ù…Ù† ${product.stock} Ù‚Ø·Ø¹Ø©`, 'warning');
        return;
      }
      existingItem.quantity++;
    } else {
      cart.push({
        id: productId,
        name: product.name,
        price: product.price,
        discount: product.discount || 0,
        image: product.imageUrl || product.image,
        quantity: 1,
        stock: product.stock
      });
    }
    
    // Update reactive store
    store.cart = [...cart];
    
    // Update button
    if (button) {
      button.classList.add('btn-success');
      button.innerHTML = '<i class="fas fa-check"></i> ÙÙŠ Ø§Ù„Ø¹Ø±Ø¨Ø©';
      setTimeout(() => {
        button.classList.remove('btn-success');
        button.innerHTML = '<i class="fas fa-cart-plus"></i> Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨Ø©';
      }, 2000);
    }
    
    showNotification(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© "${product.name}" Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨Ø©`, 'success');
  }

  function updateCartBadge() {
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    const badge = document.getElementById('cartBadge');
    if (badge) {
      badge.textContent = totalItems;
      badge.style.display = totalItems > 0 ? 'flex' : 'none';
    }
  }

  // ---------- Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙØ¶Ù„Ø© ----------
  function toggleFavorite(productId, button = null) {
    if (!currentUser) {
      showNotification('Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ù…ÙØ¶Ù„Ø©', 'warning');
      openLoginModal();
      return;
    }
    
    const isFavorite = favorites.some(fav => fav.id === productId);
    const product = globalProducts.find(p => p.id === productId);
    
    if (isFavorite) {
      favorites = favorites.filter(fav => fav.id !== productId);
      if (button) {
        button.classList.remove('active');
        button.innerHTML = '<i class="far fa-heart"></i>';
      }
      showNotification('ØªÙ…Øª Ø§Ù„Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©', 'info');
    } else {
      if (product) {
        favorites.push({
          id: productId,
          ...product
        });
        if (button) {
          button.classList.add('active');
          button.innerHTML = '<i class="fas fa-heart"></i>';
        }
        showNotification('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø©', 'success');
      }
    }
    
    // Update reactive store
    store.favorites = [...favorites];
  }

  function updateFavoritesBadge() {
    const totalFavorites = favorites.length;
    const badges = [
      document.getElementById('favoritesBadge'),
      document.getElementById('favoritesBottomBadge')
    ];
    
    badges.forEach(badge => {
      if (badge) {
        badge.textContent = totalFavorites;
        badge.style.display = totalFavorites > 0 ? 'flex' : 'none';
      }
    });
  }

  // ---------- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ----------
  async function loadCategories() {
    const container = document.getElementById('categoriesContainer');
    if (!container) return;
    
    try {
      const snapshot = await db.collection('categories')
        .orderBy('order', 'asc')
        .limit(8)
        .get();
      
      if (snapshot.empty) {
        // Default categories
        const defaultCategories = [
          { name: 'Ù…Ø¹Ù„Ø¨Ø§Øª', icon: 'fas fa-archive', color: '#FF9800', order: 1 },
          { name: 'Ø£Ù„Ø¨Ø§Ù† ÙˆØ£Ø¬Ø¨Ø§Ù†', icon: 'fas fa-cheese', color: '#FFC107', order: 2 },
          { name: 'Ù…Ø´Ø±ÙˆØ¨Ø§Øª', icon: 'fas fa-wine-bottle', color: '#9C27B0', order: 3 },
          { name: 'Ø­Ù„ÙˆÙŠØ§Øª', icon: 'fas fa-cookie-bite', color: '#795548', order: 4 },
          { name: 'Ù…Ø®Ø¨ÙˆØ²Ø§Øª', icon: 'fas fa-bread-slice', color: '#8BC34A', order: 5 },
          { name: 'Ø£Ø±Ø² ÙˆÙ…ÙƒØ±ÙˆÙ†Ø©', icon: 'fas fa-utensils', color: '#607D8B', order: 6 },
          { name: 'Ù„Ø­ÙˆÙ… ÙˆØ¯ÙˆØ§Ø¬Ù†', icon: 'fas fa-drumstick-bite', color: '#FF2D55', order: 7 },
          { name: 'Ø®Ø¶Ø±ÙˆØ§Øª ÙˆÙÙˆØ§ÙƒÙ‡', icon: 'fas fa-apple-alt', color: '#25D366', order: 8 }
        ];
        
        container.innerHTML = defaultCategories.map(cat => `
          <div class="category-card" onclick="filterByCategory('${cat.name}')">
            <div class="category-icon" style="color: ${cat.color}">
              <i class="${cat.icon}"></i>
            </div>
            <div class="category-name">${cat.name}</div>
            <div class="category-count">0 Ù…Ù†ØªØ¬</div>
          </div>
        `).join('');
        
      } else {
        container.innerHTML = snapshot.docs.map(doc => {
          const cat = doc.data();
          return `
            <div class="category-card" onclick="filterByCategory('${cat.name}')">
              <div class="category-icon" style="color: ${cat.color || '#6B5BFF'}">
                <i class="${cat.icon || 'fas fa-tag'}"></i>
              </div>
              <div class="category-name">${cat.name}</div>
              <div class="category-count">${cat.productCount || 0} Ù…Ù†ØªØ¬</div>
            </div>
          `;
        }).join('');
      }
      
    } catch (error) {
      console.error('Error loading categories:', error);
      container.innerHTML = '<p class="text-center text-muted">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</p>';
    }
  }

  async function loadProducts() {
    try {
      // Load featured products
      const featuredSnapshot = await db.collection('products')
        .where('featured', '==', true)
        .limit(6)
        .get();
      
      renderProducts('featuredContainer', featuredSnapshot.docs);
      
      // Load offers
      const offersSnapshot = await db.collection('products')
        .where('discount', '>', 0)
        .limit(6)
        .get();
      
      renderProducts('offersContainer', offersSnapshot.docs);
      
      // Load new products
      const newSnapshot = await db.collection('products')
        .orderBy('createdAt', 'desc')
        .limit(6)
        .get();
      
      renderProducts('newProductsContainer', newSnapshot.docs);
      
      // Store all products
      const allSnapshot = await db.collection('products').limit(50).get();
      globalProducts = allSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      store.products = globalProducts;
      
    } catch (error) {
      console.error('Error loading products:', error);
    }
  }

  function renderProducts(containerId, products) {
    const container = document.getElementById(containerId);
    if (!container) return;
    
    if (products.length === 0) {
      container.innerHTML = `
        <div class="text-center text-muted" style="grid-column: 1/-1; padding: 40px;">
          <i class="fas fa-box-open fa-3x mb-3" style="color: #e0e0e0;"></i>
          <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</p>
        </div>
      `;
      return;
    }
    
    container.innerHTML = products.map(doc => {
      const product = doc.data();
      const isFavorite = favorites.some(fav => fav.id === doc.id);
      const isInCart = cart.some(item => item.id === doc.id);
      
      return `
        <div class="product-card" data-id="${doc.id}">
          ${product.discount > 0 ? `
            <div class="product-badge">
              ${product.discount}% Ø®ØµÙ…
            </div>
          ` : ''}
          
          ${product.featured ? `
            <div class="product-badge featured" style="left: ${product.discount > 0 ? '70px' : '12px'}">
              <i class="fas fa-star"></i>
            </div>
          ` : ''}
          
          <div class="product-actions">
            <button class="action-btn ${isFavorite ? 'active' : ''}" 
                    onclick="toggleFavorite('${doc.id}', this)"
                    title="Ø§Ù„Ù…ÙØ¶Ù„Ø©">
              <i class="${isFavorite ? 'fas' : 'far'} fa-heart"></i>
            </button>
            <button class="action-btn" onclick="shareProduct('${doc.id}')" title="Ù…Ø´Ø§Ø±ÙƒØ©">
              <i class="fas fa-share-alt"></i>
            </button>
          </div>
          
          <img src="${product.imageUrl || product.image || 'https://via.placeholder.com/300x200/6B5BFF/ffffff?text=ØµÙˆØ±Ø©+Ø§Ù„Ù…Ù†ØªØ¬'}" 
               alt="${product.name}"
               class="product-image"
               loading="lazy"
               onerror="this.src='https://via.placeholder.com/300x200/6B5BFF/ffffff?text=ØµÙˆØ±Ø©+Ø§Ù„Ù…Ù†ØªØ¬'">
          
          <div class="product-info">
            <h3 class="product-name">${product.name}</h3>
            <div class="product-category">${product.category || 'Ø¹Ø§Ù…'}</div>
            
            <div class="product-price">
              <span class="price-current">
                ${(product.price * (1 - (product.discount || 0) / 100)).toFixed(2)} Ø¬Ù†ÙŠÙ‡
              </span>
              ${product.discount > 0 ? `
                <span class="price-old">${product.price.toFixed(2)} Ø¬Ù†ÙŠÙ‡</span>
              ` : ''}
            </div>
            
            <button class="add-to-cart-btn ${isInCart ? 'btn-success' : ''}" 
                    onclick="addToCart('${doc.id}', this)"
                    ${product.stock === 0 ? 'disabled' : ''}>
              <i class="${isInCart ? 'fas fa-check' : 'fas fa-cart-plus'}"></i>
              ${isInCart ? 'ÙÙŠ Ø§Ù„Ø¹Ø±Ø¨Ø©' : product.stock === 0 ? 'Ù†ÙØ°Øª Ø§Ù„ÙƒÙ…ÙŠØ©' : 'Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨Ø©'}
            </button>
          </div>
        </div>
      `;
    }).join('');
  }

  // ---------- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ----------
  async function createOrder() {
    if (!currentUser) {
      showNotification('Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨', 'warning');
      openLoginModal();
      return;
    }
    
    if (cart.length === 0) {
      showNotification('Ø§Ù„Ø¹Ø±Ø¨Ø© ÙØ§Ø±ØºØ©', 'warning');
      return;
    }
    
    try {
      const subtotal = cart.reduce((sum, item) => {
        return sum + (item.price * (1 - item.discount / 100) * item.quantity);
      }, 0);
      
      const shipping = subtotal > 300 ? 0 : 20;
      const total = subtotal + shipping;
      
      const orderData = {
        userId: currentUser.uid,
        userName: userData?.name || currentUser.displayName || 'Ù…Ø³ØªØ®Ø¯Ù…',
        userPhone: userData?.phone || '',
        userEmail: currentUser.email,
        userAddress: userData?.address || '',
        
        items: cart.map(item => ({
          productId: item.id,
          name: item.name,
          price: item.price,
          discount: item.discount,
          quantity: item.quantity,
          image: item.image
        })),
        
        subtotal: subtotal,
        shipping: shipping,
        total: total,
        
        paymentMethod: 'cash',
        paymentStatus: 'pending',
        
        status: 'pending',
        statusHistory: [{
          status: 'pending',
          timestamp: firebase.firestore.FieldValue.serverTimestamp(),
          note: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨'
        }],
        
        notes: '',
        
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      };
      
      // Add order to database
      const docRef = await db.collection('orders').add(orderData);
      
      // Update product stock
      for (const item of cart) {
        const productRef = db.collection('products').doc(item.id);
        const productDoc = await productRef.get();
        
        if (productDoc.exists) {
          const product = productDoc.data();
          const newStock = Math.max(0, (product.stock || 0) - item.quantity);
          await productRef.update({ stock: newStock });
        }
      }
      
      // Send notification to user
      await db.collection('notifications').add({
        userId: currentUser.uid,
        title: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­',
        message: `ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨Ùƒ Ø¨Ø±Ù‚Ù… #${docRef.id.substring(0, 8)}. ÙŠÙ…ÙƒÙ†Ùƒ ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† ØµÙØ­Ø© Ø·Ù„Ø¨Ø§ØªÙŠ.`,
        type: 'order',
        read: false,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      
      // Notify admins
      notifyAdminsNewOrder(docRef.id, orderData.userName, total);
      
      // Clear cart
      cart = [];
      store.cart = [];
      
      // Close modal
      closeModal();
      
      // Show success message
      const successHTML = `
        <div class="modal-overlay" onclick="closeModal()">
          <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal()">
              <i class="fas fa-times"></i>
            </button>
            <div class="modal-body">
              <div class="text-center" style="padding: 40px 20px;">
                <div style="width: 80px; height: 80px; background: var(--whatsapp-green); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 2rem;">
                  <i class="fas fa-check"></i>
                </div>
                <h3 class="mb-3">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!</h3>
                <p class="text-muted mb-2">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: #${docRef.id.substring(0, 8)}</p>
                <p class="text-muted mb-4">Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø© Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</p>
                <button class="btn btn-primary" onclick="closeModal(); openOrders();">
                  <i class="fas fa-shopping-bag"></i>
                  Ø¹Ø±Ø¶ Ø·Ù„Ø¨Ø§ØªÙŠ
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('modalsContainer').innerHTML = successHTML;
      
    } catch (error) {
      console.error('Error creating order:', error);
      showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨', 'error');
    }
  }

  // ---------- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù…Ø¯ÙŠØ± ----------
  async function openAdminPanel() {
    if (!currentUser || userData?.role !== 'admin') {
      showNotification('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', 'error');
      return;
    }
    
    const modalHTML = `
      <div class="modal-overlay" onclick="closeModal()">
        <div class="admin-panel" onclick="event.stopPropagation()">
          <button class="modal-close" onclick="closeModal()" style="position: absolute; top: 20px; left: 20px;">
            <i class="fas fa-times"></i>
          </button>
          
          <div class="admin-header">
            <h2 class="admin-title">
              <i class="fas fa-tools"></i>
              Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±
            </h2>
            <p class="admin-subtitle">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø± Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ù† Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯</p>
          </div>
          
          <div class="admin-stats" id="adminStats">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-shopping-cart"></i>
              </div>
              <div class="stat-value" id="statOrders">0</div>
              <div class="stat-label">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-box"></i>
              </div>
              <div class="stat-value" id="statProducts">0</div>
              <div class="stat-label">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-users"></i>
              </div>
              <div class="stat-value" id="statUsers">0</div>
              <div class="stat-label">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-money-bill-wave"></i>
              </div>
              <div class="stat-value" id="statRevenue">0</div>
              <div class="stat-label">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
            </div>
          </div>
          
          <div class="admin-tabs">
            <button class="admin-tab active" onclick="showAdminTab('products', this)">
              <i class="fas fa-box"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            </button>
            <button class="admin-tab" onclick="showAdminTab('orders', this)">
              <i class="fas fa-shopping-cart"></i> Ø§Ù„Ø·Ù„Ø¨Ø§Øª
            </button>
            <button class="admin-tab" onclick="showAdminTab('categories', this)">
              <i class="fas fa-tags"></i> Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
            </button>
            <button class="admin-tab" onclick="showAdminTab('users', this)">
              <i class="fas fa-users"></i> Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            </button>
          </div>
          
          <div class="admin-content" id="adminContent">
            <div class="loading">
              <div class="spinner"></div>
            </div>
          </div>
        </div>
      </div>
    `;
    
    document.getElementById('modalsContainer').innerHTML = modalHTML;
    
    // Load stats
    await loadAdminStats();
    
    // Load first tab
    showAdminTab('products', document.querySelector('.admin-tab.active'));
  }

  async function loadAdminStats() {
    try {
      const [ordersSnapshot, productsSnapshot, usersSnapshot] = await Promise.all([
        db.collection('orders').get(),
        db.collection('products').get(),
        db.collection('users').get()
      ]);
      
      const totalRevenue = ordersSnapshot.docs.reduce((sum, doc) => {
        const order = doc.data();
        return sum + (order.total || 0);
      }, 0);
      
      document.getElementById('statOrders').textContent = ordersSnapshot.size;
      document.getElementById('statProducts').textContent = productsSnapshot.size;
      document.getElementById('statUsers').textContent = usersSnapshot.size;
      document.getElementById('statRevenue').textContent = totalRevenue.toFixed(2);
      
    } catch (error) {
      console.error('Error loading admin stats:', error);
    }
  }

  async function showAdminTab(tabName, button) {
    // Update active tabs
    document.querySelectorAll('.admin-tab').forEach(tab => {
      tab.classList.remove('active');
    });
    button.classList.add('active');
    
    const contentEl = document.getElementById('adminContent');
    
    switch (tabName) {
      case 'products':
        await loadAdminProducts(contentEl);
        break;
      case 'orders':
        await loadAdminOrders(contentEl);
        break;
      case 'categories':
        await loadAdminCategories(contentEl);
        break;
      case 'users':
        await loadAdminUsers(contentEl);
        break;
    }
  }

  async function loadAdminProducts(container) {
    try {
      const snapshot = await db.collection('products')
        .orderBy('createdAt', 'desc')
        .limit(20)
        .get();
      
      if (snapshot.empty) {
        container.innerHTML = `
          <div class="text-center text-muted" style="padding: 40px;">
            <i class="fas fa-box-open fa-3x mb-3"></i>
            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</p>
          </div>
        `;
        return;
      }
      
      let tableHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
          <button class="btn btn-primary" onclick="openAddProductModal()">
            <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
          </button>
        </div>
        <div style="overflow-x: auto;">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Ø§Ù„ØµÙˆØ±Ø©</th>
                <th>Ø§Ù„Ø§Ø³Ù…</th>
                <th>Ø§Ù„Ø³Ø¹Ø±</th>
                <th>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</th>
                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
              </tr>
            </thead>
            <tbody>
      `;
      
      snapshot.docs.forEach(doc => {
        const product = doc.data();
        tableHTML += `
          <tr>
            <td>
              <img src="${product.imageUrl || product.image || 'https://via.placeholder.com/50/6B5BFF/ffffff?text=ØµÙˆØ±Ø©'}" 
                   alt="${product.name}"
                   style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px;">
            </td>
            <td>${product.name}</td>
            <td>${product.price?.toFixed(2) || '0'} Ø¬Ù†ÙŠÙ‡</td>
            <td>${product.stock || 0}</td>
            <td>
              <button class="btn btn-sm btn-primary" onclick="editProduct('${doc.id}')">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-danger" onclick="deleteProduct('${doc.id}')">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        `;
      });
      
      tableHTML += `
            </tbody>
          </table>
        </div>
      `;
      
      container.innerHTML = tableHTML;
      
    } catch (error) {
      console.error('Error loading admin products:', error);
      container.innerHTML = `
        <div class="text-center text-danger">
          <i class="fas fa-exclamation-circle fa-2x mb-2"></i>
          <p>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</p>
        </div>
      `;
    }
  }

  function openAddProductModal() {
    const modalHTML = `
        <div class="modal-overlay" onclick="closeModal()">
            <div class="modal" onclick="event.stopPropagation()">
                <button class="modal-close" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
                <div class="modal-header">
                    <h2 class="modal-title">
                        <i class="fas fa-plus"></i>
                        Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
                    </h2>
                </div>
                <div class="modal-body">
                    <div class="admin-form">
                        <div class="form-group">
                            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ *</label>
                            <input type="text" class="form-control" id="productName" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø³Ø¹Ø± (Ø¬Ù†ÙŠÙ‡) *</label>
                            <input type="number" class="form-control" id="productPrice" step="0.01" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø®ØµÙ… (%)</label>
                            <input type="number" class="form-control" id="productDiscount" min="0" max="100" value="0">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù…Ø®Ø²ÙˆÙ† *</label>
                            <input type="number" class="form-control" id="productStock" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ (Ø±Ø§Ø¨Ø· URL) *</label>
                            <input type="url" class="form-control" id="productImage" required>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button class="btn btn-outline" onclick="closeModal()">
                        <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button class="btn btn-primary" onclick="saveNewProduct()">
                        <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.getElementById('modalsContainer').innerHTML = modalHTML;
  }

  async function saveNewProduct() {
    try {
        const productData = {
            name: document.getElementById('productName').value.trim(),
            price: parseFloat(document.getElementById('productPrice').value),
            discount: parseInt(document.getElementById('productDiscount').value) || 0,
            stock: parseInt(document.getElementById('productStock').value),
            image: document.getElementById('productImage').value.trim(),
            category: 'Ø¹Ø§Ù…',
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        if (!productData.name || productData.price <= 0 || productData.stock < 0 || !productData.image) {
            showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­', 'warning');
            return;
        }
        
        await db.collection('products').add(productData);
        
        showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        closeModal();
        
        // Refresh products list
        const currentTab = document.querySelector('.admin-tab.active');
        if (currentTab.textContent.includes('Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª')) {
            showAdminTab('products', currentTab);
        }
        
    } catch (error) {
        console.error('Error saving product:', error);
        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬', 'error');
    }
  }

  // ---------- Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ----------
  function updateUI() {
    // Update user profile
    const userNameEl = document.getElementById('userName');
    const userAvatarEl = document.getElementById('userAvatar');
    
    if (currentUser && userData) {
      if (userNameEl) userNameEl.textContent = userData.name;
      if (userAvatarEl) userAvatarEl.src = userData.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(userData.name)}&background=6B5BFF&color=fff&size=64`;
    } else {
      if (userNameEl) userNameEl.textContent = 'Ù…Ø³ØªØ®Ø¯Ù…';
      if (userAvatarEl) userAvatarEl.src = 'https://ui-avatars.com/api/?name=Ù…Ø³ØªØ®Ø¯Ù…&background=6B5BFF&color=fff&size=64';
    }
  }

  function updateUserProfile() {
    // Update profile image in dropdown
    const userAvatar = document.getElementById('userAvatar');
    const userName = document.getElementById('userName');
    
    if (currentUser && userData) {
      userAvatar.src = userData.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(userData.name)}&background=6B5BFF&color=fff&size=64`;
      userName.textContent = userData.name;
    }
  }

  function setActiveNav(item) {
    document.querySelectorAll('.nav-item').forEach(nav => {
      nav.classList.remove('active');
    });
    item.classList.add('active');
  }

  function closeModal() {
    document.getElementById('modalsContainer').innerHTML = '';
  }

  function goHome() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function openWhatsapp() {
    window.open(`https://wa.me/${APP_CONFIG.whatsapp}`, '_blank');
  }

  function openPhone() {
    window.open(`tel:${APP_CONFIG.phone}`, '_self');
  }

  function openCart() {
    if (cart.length === 0) {
      const modalHTML = `
        <div class="modal-overlay" onclick="closeModal()">
          <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal()">
              <i class="fas fa-times"></i>
            </button>
            <div class="modal-body">
              <div class="text-center" style="padding: 40px 20px;">
                <i class="fas fa-shopping-cart fa-4x mb-3" style="color: #e0e0e0;"></i>
                <h3 class="mb-3">Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚ ÙØ§Ø±ØºØ©</h3>
                <p class="text-muted mb-4">Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨Ø© Ø¨Ø¹Ø¯</p>
                <button class="btn btn-primary" onclick="closeModal(); showAllProductsPage();">
                  <i class="fas fa-shopping-bag"></i>
                  ØªØµÙØ­ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('modalsContainer').innerHTML = modalHTML;
      return;
    }
    
    // Calculate totals
    const subtotal = cart.reduce((sum, item) => {
      return sum + (item.price * (1 - item.discount / 100) * item.quantity);
    }, 0);
    
    const shipping = subtotal > 300 ? 0 : 20;
    const total = subtotal + shipping;
    
    const modalHTML = `
      <div class="modal-overlay" onclick="closeModal()">
        <div class="modal" onclick="event.stopPropagation()">
          <button class="modal-close" onclick="closeModal()">
            <i class="fas fa-times"></i>
          </button>
          <div class="modal-header">
            <h2 class="modal-title">
              <i class="fas fa-shopping-cart"></i>
              Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚
            </h2>
          </div>
          <div class="modal-body">
            <div style="max-height: 300px; overflow-y: auto;">
              ${cart.map((item, index) => `
                <div class="cart-item">
                  <img src="${item.image || 'https://via.placeholder.com/80/6B5BFF/ffffff?text=ØµÙˆØ±Ø©'}" 
                       alt="${item.name}"
                       class="cart-item-image">
                  
                  <div class="cart-item-content">
                    <h3 class="cart-item-name">${item.name}</h3>
                    <div class="cart-item-price">
                      ${(item.price * (1 - item.discount / 100)).toFixed(2)} Ø¬Ù†ÙŠÙ‡
                    </div>
                  </div>
                  
                  <div class="cart-item-actions">
                    <div class="quantity-control">
                      <button class="quantity-btn" onclick="updateCartQuantity(${index}, -1)">
                        <i class="fas fa-minus"></i>
                      </button>
                      <span class="quantity-value">${item.quantity}</span>
                      <button class="quantity-btn" onclick="updateCartQuantity(${index}, 1)">
                        <i class="fas fa-plus"></i>
                      </button>
                    </div>
                    
                    <button class="btn btn-danger btn-sm" onclick="removeFromCart(${index})">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </div>
              `).join('')}
            </div>
            
            <div class="cart-summary">
              <div class="summary-row">
                <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</span>
                <span>${subtotal.toFixed(2)} Ø¬Ù†ÙŠÙ‡</span>
              </div>
              
              <div class="summary-row">
                <span>Ø§Ù„Ø´Ø­Ù†</span>
                <span>${shipping === 0 ? 'Ù…Ø¬Ø§Ù†ÙŠ' : shipping.toFixed(2) + ' Ø¬Ù†ÙŠÙ‡'}</span>
              </div>
              
              <div class="summary-row total">
                <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span>
                <span>${total.toFixed(2)} Ø¬Ù†ÙŠÙ‡</span>
              </div>
            </div>
          </div>
          
          <div class="modal-footer">
            <button class="btn btn-outline" onclick="closeModal()">
              <i class="fas fa-times"></i>
              Ø¥ØºÙ„Ø§Ù‚
            </button>
            <button class="btn btn-primary" onclick="openCheckout()">
              <i class="fas fa-check-circle"></i>
              Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨
            </button>
          </div>
        </div>
      </div>
    `;
    
    document.getElementById('modalsContainer').innerHTML = modalHTML;
  }

  function updateCartQuantity(index, change) {
    const item = cart[index];
    
    if (change === -1 && item.quantity === 1) {
      removeFromCart(index);
      return;
    }
    
    item.quantity += change;
    store.cart = [...cart];
    openCart();
  }

  function removeFromCart(index) {
    const item = cart[index];
    cart.splice(index, 1);
    store.cart = [...cart];
    showNotification(`ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© "${item.name}" Ù…Ù† Ø§Ù„Ø¹Ø±Ø¨Ø©`, 'info');
    
    if (cart.length === 0) {
      closeModal();
    } else {
      openCart();
    }
  }

  function openCheckout() {
    if (!currentUser) {
      showNotification('Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨', 'warning');
      openLoginModal();
      closeModal();
      return;
    }
    
    if (cart.length === 0) {
      showNotification('Ø§Ù„Ø¹Ø±Ø¨Ø© ÙØ§Ø±ØºØ©', 'warning');
      return;
    }
    
    const modalHTML = `
      <div class="modal-overlay" onclick="closeModal()">
        <div class="modal" onclick="event.stopPropagation()">
          <button class="modal-close" onclick="closeModal()">
            <i class="fas fa-times"></i>
          </button>
          <div class="modal-header">
            <h2 class="modal-title">
              <i class="fas fa-check-circle"></i>
              Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨
            </h2>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
              <input type="text" class="form-control" id="checkoutName" 
                     value="${userData?.name || ''}" required>
            </div>
            
            <div class="form-group">
              <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
              <input type="tel" class="form-control" id="checkoutPhone" 
                     value="${userData?.phone || ''}" required>
            </div>
            
            <div class="form-group">
              <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„</label>
              <textarea class="form-control" id="checkoutAddress" rows="3" required>${userData?.address || ''}</textarea>
            </div>
            
            <button class="btn btn-primary btn-block" onclick="createOrder()">
              <i class="fas fa-check"></i>
              ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨
            </button>
          </div>
        </div>
      </div>
    `;
    
    document.getElementById('modalsContainer').innerHTML = modalHTML;
  }

  // ---------- Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ----------
  function openLoginModal() {
    const modalHTML = `
      <div class="modal-overlay" onclick="closeModal()">
        <div class="modal" onclick="event.stopPropagation()">
          <button class="modal-close" onclick="closeModal()">
            <i class="fas fa-times"></i>
          </button>
          <div class="modal-header">
            <h2 class="modal-title">
              <i class="fas fa-sign-in-alt"></i>
              ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            </h2>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
              <input type="email" class="form-control" id="loginEmail" placeholder="example@email.com">
            </div>
            
            <div class="form-group">
              <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
              <input type="password" class="form-control" id="loginPassword" placeholder="********">
            </div>
            
            <button class="btn btn-primary btn-block mb-3" onclick="emailLogin()">
              <i class="fas fa-sign-in-alt"></i>
              ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            </button>
            
            <div style="text-align: center; margin-top: 20px;">
              <a href="#" onclick="openRegisterModal()" style="color: var(--primary-color);">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a>
            </div>
          </div>
        </div>
      </div>
    `;
    
    document.getElementById('modalsContainer').innerHTML = modalHTML;
  }

  async function emailLogin() {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    if (!email || !password) {
      showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'warning');
      return;
    }
    
    try {
      await auth.signInWithEmailAndPassword(email, password);
      showNotification('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ!', 'success');
      closeModal();
    } catch (error) {
      console.error('Login error:', error);
      
      let errorMessage = 'Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
      if (error.code === 'auth/user-not-found') {
        errorMessage = 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯';
      } else if (error.code === 'auth/wrong-password') {
        errorMessage = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
      }
      
      showNotification(errorMessage, 'error');
    }
  }

  function openRegisterModal() {
    const modalHTML = `
      <div class="modal-overlay" onclick="closeModal()">
        <div class="modal" onclick="event.stopPropagation()">
          <button class="modal-close" onclick="closeModal()">
            <i class="fas fa-times"></i>
          </button>
          <div class="modal-header">
            <h2 class="modal-title">
              <i class="fas fa-user-plus"></i>
              Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
            </h2>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
              <input type="text" class="form-control" id="registerName" placeholder="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯">
            </div>
            
            <div class="form-group">
              <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
              <input type="email" class="form-control" id="registerEmail" placeholder="example@email.com">
            </div>
            
            <div class="form-group">
              <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
              <input type="password" class="form-control" id="registerPassword" placeholder="********">
            </div>
            
            <button class="btn btn-primary btn-block" onclick="emailRegister()">
              <i class="fas fa-user-plus"></i>
              Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
            </button>
            
            <div style="text-align: center; margin-top: 20px;">
              <a href="#" onclick="openLoginModal()" style="color: var(--primary-color);">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„</a>
            </div>
          </div>
        </div>
      </div>
    `;
    
    document.getElementById('modalsContainer').innerHTML = modalHTML;
  }

  async function emailRegister() {
    const name = document.getElementById('registerName').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    
    if (!name || !email || !password) {
      showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'warning');
      return;
    }
    
    if (password.length < 6) {
      showNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'warning');
      return;
    }
    
    try {
      const userCredential = await auth.createUserWithEmailAndPassword(email, password);
      
      // Update display name
      await userCredential.user.updateProfile({
        displayName: name
      });
      
      // Create user document
      await db.collection('users').doc(userCredential.user.uid).set({
        name: name,
        email: email,
        role: 'customer',
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        photoURL: `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=6B5BFF&color=fff&size=64`
      });
      
      showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
      closeModal();
      
    } catch (error) {
      console.error('Register error:', error);
      
      let errorMessage = 'Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨';
      if (error.code === 'auth/email-already-in-use') {
        errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„';
      }
      
      showNotification(errorMessage, 'error');
    }
  }

  async function logoutUser() {
    try {
      await auth.signOut();
      showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'info');
      goHome();
    } catch (error) {
      console.error('Logout error:', error);
      showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'error');
    }
  }

  // ---------- Ø§Ù„Ø¨Ø­Ø« ----------
  function searchProducts() {
    const searchTerm = document.querySelector('.search-input')?.value.trim();
    if (!searchTerm) return;
    
    const results = globalProducts.filter(product => 
      product.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      product.category?.toLowerCase().includes(searchTerm.toLowerCase())
    );
    
    const content = `
      <section class="hero-section">
        <div class="hero-content">
          <h1 class="hero-title">ğŸ” Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</h1>
          <p class="hero-subtitle">${results.length} Ù…Ù†ØªØ¬ Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù€ "${searchTerm}"</p>
        </div>
      </section>
      
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-search"></i>
            Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
          </h2>
        </div>
        <div class="products-grid">
          ${results.length > 0 ? results.map(product => {
            const isFavorite = favorites.some(fav => fav.id === product.id);
            const isInCart = cart.some(item => item.id === product.id);
            
            return `
              <div class="product-card" data-id="${product.id}">
                <img src="${product.imageUrl || product.image || 'https://via.placeholder.com/300x200/6B5BFF/ffffff?text=ØµÙˆØ±Ø©+Ø§Ù„Ù…Ù†ØªØ¬'}" 
                     alt="${product.name}"
                     class="product-image">
                
                <div class="product-info">
                  <h3 class="product-name">${product.name}</h3>
                  <div class="product-category">${product.category || 'Ø¹Ø§Ù…'}</div>
                  
                  <div class="product-price">
                    <span class="price-current">
                      ${(product.price * (1 - (product.discount || 0) / 100)).toFixed(2)} Ø¬Ù†ÙŠÙ‡
                    </span>
                  </div>
                  
                  <button class="add-to-cart-btn ${isInCart ? 'btn-success' : ''}" onclick="addToCart('${product.id}', this)">
                    <i class="fas fa-cart-plus"></i>
                    Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨Ø©
                  </button>
                </div>
              </div>
            `;
          }).join('') : `
            <div class="text-center text-muted" style="grid-column: 1/-1; padding: 60px;">
              <i class="fas fa-search fa-4x mb-3" style="color: #e0e0e0;"></i>
              <h3 class="mb-3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©</h3>
            </div>
          `}
        </div>
      </section>
    `;
    
    document.getElementById('mainContent').innerHTML = content;
  }

  // ---------- Mobile Search ----------
  function toggleMobileSearch() {
    const mobileSearch = document.getElementById('mobileSearch');
    mobileSearch.style.display = mobileSearch.style.display === 'flex' ? 'none' : 'flex';
    
    if (mobileSearch.style.display === 'flex') {
      document.getElementById('mobileSearchInput').focus();
    }
  }

  function searchFromMobile() {
    const searchTerm = document.getElementById('mobileSearchInput').value.trim();
    if (searchTerm) {
      searchProducts();
      toggleMobileSearch();
    }
  }

  // ---------- Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ----------
  function setupEventListeners() {
    // Navbar scroll effect
    window.addEventListener('scroll', () => {
      const navbar = document.getElementById('navbar');
      if (window.scrollY > 50) {
        navbar.classList.add('scrolled');
      } else {
        navbar.classList.remove('scrolled');
      }
    });
    
    // Search on Enter
    document.querySelector('.search-input')?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        searchProducts();
      }
    });
    
    // Close mobile search when clicking outside
    document.addEventListener('click', (e) => {
      const mobileSearch = document.getElementById('mobileSearch');
      const mobileSearchBtn = document.querySelector('.mobile-search-btn');
      
      if (mobileSearch && mobileSearchBtn && 
          !mobileSearch.contains(e.target) && 
          !mobileSearchBtn.contains(e.target) && 
          mobileSearch.style.display === 'flex') {
        mobileSearch.style.display = 'none';
      }
    });
    
    // Network status
    window.addEventListener('online', () => {
      showNotification('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'success');
    });
    
    window.addEventListener('offline', () => {
      showNotification('Ø£Ù†Øª ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'warning');
    });
    
    // Close modals on Escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeModal();
      }
    });
  }

  // ---------- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ù‚Ù„ ----------
  function showAllProductsPage() {
    const content = `
      <section class="hero-section">
        <div class="hero-content">
          <h1 class="hero-title">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h1>
          <p class="hero-subtitle">ØªØµÙØ­ Ø¬Ù…ÙŠØ¹ Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§ Ø§Ù„Ù…Ù…ÙŠØ²Ø©</p>
        </div>
      </section>
      
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-list"></i>
            Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
          </h2>
        </div>
        <div class="products-grid">
          ${globalProducts.length > 0 ? globalProducts.map(product => {
            const isInCart = cart.some(item => item.id === product.id);
            
            return `
              <div class="product-card" data-id="${product.id}">
                <img src="${product.imageUrl || product.image || 'https://via.placeholder.com/300x200/6B5BFF/ffffff?text=ØµÙˆØ±Ø©+Ø§Ù„Ù…Ù†ØªØ¬'}" 
                     alt="${product.name}"
                     class="product-image">
                
                <div class="product-info">
                  <h3 class="product-name">${product.name}</h3>
                  <div class="product-category">${product.category || 'Ø¹Ø§Ù…'}</div>
                  
                  <div class="product-price">
                    <span class="price-current">
                      ${(product.price * (1 - (product.discount || 0) / 100)).toFixed(2)} Ø¬Ù†ÙŠÙ‡
                    </span>
                  </div>
                  
                  <button class="add-to-cart-btn ${isInCart ? 'btn-success' : ''}" onclick="addToCart('${product.id}', this)">
                    <i class="fas fa-cart-plus"></i>
                    Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨Ø©
                  </button>
                </div>
              </div>
            `;
          }).join('') : `
            <div class="text-center text-muted" style="grid-column: 1/-1; padding: 60px;">
              <i class="fas fa-box-open fa-4x mb-3" style="color: #e0e0e0;"></i>
              <h3 class="mb-3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</h3>
            </div>
          `}
        </div>
      </section>
    `;
    
    document.getElementById('mainContent').innerHTML = content;
  }

  function showOffersPage() {
    const offers = globalProducts.filter(p => p.discount > 0);
    
    const content = `
      <section class="hero-section" style="background: linear-gradient(135deg, rgba(255, 127, 0, 0.9), rgba(255, 107, 0, 0.9));">
        <div class="hero-content">
          <h1 class="hero-title">ğŸ”¥ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø­ØµØ±ÙŠØ© ğŸ”¥</h1>
          <p class="hero-subtitle">Ø®ØµÙˆÙ…Ø§Øª ØªØµÙ„ Ø¥Ù„Ù‰ 70% Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø®ØªØ§Ø±Ø©</p>
        </div>
      </section>
      
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-fire"></i>
            Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ø±ÙˆØ¶
          </h2>
        </div>
        <div class="products-grid">
          ${offers.length > 0 ? offers.map(product => {
            const isInCart = cart.some(item => item.id === product.id);
            
            return `
              <div class="product-card" data-id="${product.id}">
                <div class="product-badge">
                  ${product.discount}% Ø®ØµÙ…
                </div>
                
                <img src="${product.imageUrl || product.image || 'https://via.placeholder.com/300x200/6B5BFF/ffffff?text=ØµÙˆØ±Ø©+Ø§Ù„Ù…Ù†ØªØ¬'}" 
                     alt="${product.name}"
                     class="product-image">
                
                <div class="product-info">
                  <h3 class="product-name">${product.name}</h3>
                  <div class="product-category">${product.category || 'Ø¹Ø§Ù…'}</div>
                  
                  <div class="product-price">
                    <span class="price-current">
                      ${(product.price * (1 - product.discount / 100)).toFixed(2)} Ø¬Ù†ÙŠÙ‡
                    </span>
                    <span class="price-old">${product.price.toFixed(2)} Ø¬Ù†ÙŠÙ‡</span>
                  </div>
                  
                  <button class="add-to-cart-btn ${isInCart ? 'btn-success' : ''}" onclick="addToCart('${product.id}', this)">
                    <i class="fas fa-cart-plus"></i>
                    Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨Ø©
                  </button>
                </div>
              </div>
            `;
          }).join('') : `
            <div class="text-center text-muted" style="grid-column: 1/-1; padding: 60px;">
              <i class="fas fa-percentage fa-4x mb-3" style="color: #e0e0e0;"></i>
              <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
            </div>
          `}
        </div>
      </section>
    `;
    
    document.getElementById('mainContent').innerHTML = content;
  }

  function showCategoriesPage() {
    const content = `
      <section class="hero-section">
        <div class="hero-content">
          <h1 class="hero-title">ğŸ·ï¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</h1>
          <p class="hero-subtitle">ØªØµÙØ­ Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ù…ØªÙ†ÙˆØ¹Ø©</p>
        </div>
      </section>
      
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-tags"></i>
            ØªØµÙØ­ Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙ
          </h2>
        </div>
        <div class="categories-grid" id="allCategoriesGrid">
          <div class="loading" style="grid-column: 1/-1;">
            <div class="spinner"></div>
          </div>
        </div>
      </section>
    `;
    
    document.getElementById('mainContent').innerHTML = content;
    loadAllCategories();
  }

  async function loadAllCategories() {
    try {
      const snapshot = await db.collection('categories').orderBy('order', 'asc').get();
      const container = document.getElementById('allCategoriesGrid');
      
      if (snapshot.empty) {
        container.innerHTML = `
          <div class="text-center text-muted" style="grid-column: 1/-1; padding: 60px;">
            <i class="fas fa-tags fa-4x mb-3" style="color: #e0e0e0;"></i>
            <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØµÙ†ÙŠÙØ§Øª</h3>
          </div>
        `;
        return;
      }
      
      container.innerHTML = snapshot.docs.map(doc => {
        const cat = doc.data();
        return `
          <div class="category-card" onclick="filterByCategory('${cat.name}')">
            <div class="category-icon" style="color: ${cat.color || '#6B5BFF'}">
              <i class="${cat.icon || 'fas fa-tag'}"></i>
            </div>
            <div class="category-name">${cat.name}</div>
            <div class="category-count">${cat.productCount || 0} Ù…Ù†ØªØ¬</div>
          </div>
        `;
      }).join('');
      
    } catch (error) {
      console.error('Error loading all categories:', error);
    }
  }

  function filterByCategory(categoryName) {
    const filteredProducts = globalProducts.filter(p => p.category === categoryName);
    
    const content = `
      <section class="hero-section">
        <div class="hero-content">
          <h1 class="hero-title">${categoryName}</h1>
          <p class="hero-subtitle">${filteredProducts.length} Ù…Ù†ØªØ¬ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙ</p>
        </div>
      </section>
      
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-filter"></i>
            ${categoryName}
          </h2>
        </div>
        <div class="products-grid">
          ${filteredProducts.length > 0 ? filteredProducts.map(product => {
            const isInCart = cart.some(item => item.id === product.id);
            
            return `
              <div class="product-card" data-id="${product.id}">
                <img src="${product.imageUrl || product.image || 'https://via.placeholder.com/300x200/6B5BFF/ffffff?text=ØµÙˆØ±Ø©+Ø§Ù„Ù…Ù†ØªØ¬'}" 
                     alt="${product.name}"
                     class="product-image">
                
                <div class="product-info">
                  <h3 class="product-name">${product.name}</h3>
                  
                  <div class="product-price">
                    <span class="price-current">
                      ${(product.price * (1 - (product.discount || 0) / 100)).toFixed(2)} Ø¬Ù†ÙŠÙ‡
                    </span>
                  </div>
                  
                  <button class="add-to-cart-btn ${isInCart ? 'btn-success' : ''}" onclick="addToCart('${product.id}', this)">
                    <i class="fas fa-cart-plus"></i>
                    Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨Ø©
                  </button>
                </div>
              </div>
            `;
          }).join('') : `
            <div class="text-center text-muted" style="grid-column: 1/-1; padding: 60px;">
              <i class="fas fa-box-open fa-4x mb-3" style="color: #e0e0e0;"></i>
              <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙ</h3>
            </div>
          `}
        </div>
      </section>
    `;
    
    document.getElementById('mainContent').innerHTML = content;
  }

  function openWishlist() {
    if (!currentUser) {
      showNotification('Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙØ¶Ù„Ø©', 'warning');
      openLoginModal();
      return;
    }
    
    if (favorites.length === 0) {
      const modalHTML = `
        <div class="modal-overlay" onclick="closeModal()">
          <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal()">
              <i class="fas fa-times"></i>
            </button>
            <div class="modal-body">
              <div class="text-center" style="padding: 40px 20px;">
                <i class="fas fa-heart fa-4x mb-3" style="color: #e0e0e0;"></i>
                <h3 class="mb-3">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙØ§Ø±ØºØ©</h3>
                <p class="text-muted mb-4">Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙØ¶Ù„Ø© Ø¨Ø¹Ø¯</p>
                <button class="btn btn-primary" onclick="closeModal(); showAllProductsPage();">
                  <i class="fas fa-shopping-bag"></i>
                  ØªØµÙØ­ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('modalsContainer').innerHTML = modalHTML;
      return;
    }
    
    const content = `
      <section class="hero-section" style="background: linear-gradient(135deg, rgba(255, 45, 85, 0.9), rgba(255, 71, 87, 0.9));">
        <div class="hero-content">
          <h1 class="hero-title">â¤ï¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø©</h1>
          <p class="hero-subtitle">${favorites.length} Ù…Ù†ØªØ¬ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø©</p>
        </div>
      </section>
      
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-heart"></i>
            Ù…Ù†ØªØ¬Ø§ØªÙŠ Ø§Ù„Ù…ÙØ¶Ù„Ø©
          </h2>
        </div>
        <div class="products-grid">
          ${favorites.map(product => {
            const isInCart = cart.some(item => item.id === product.id);
            
            return `
              <div class="product-card" data-id="${product.id}">
                <div class="product-actions">
                  <button class="action-btn active" onclick="toggleFavorite('${product.id}', this)">
                    <i class="fas fa-heart"></i>
                  </button>
                </div>
                
                <img src="${product.imageUrl || product.image || 'https://via.placeholder.com/300x200/6B5BFF/ffffff?text=ØµÙˆØ±Ø©+Ø§Ù„Ù…Ù†ØªØ¬'}" 
                     alt="${product.name}"
                     class="product-image">
                
                <div class="product-info">
                  <h3 class="product-name">${product.name}</h3>
                  <div class="product-category">${product.category || 'Ø¹Ø§Ù…'}</div>
                  
                  <button class="add-to-cart-btn ${isInCart ? 'btn-success' : ''}" onclick="addToCart('${product.id}', this)">
                    <i class="fas fa-cart-plus"></i>
                    Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨Ø©
                  </button>
                </div>
              </div>
            `;
          }).join('')}
        </div>
      </section>
    `;
    
    document.getElementById('mainContent').innerHTML = content;
  }

  function openOrders() {
    if (!currentUser) {
      showNotification('Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª', 'warning');
      openLoginModal();
      return;
    }
    
    const content = `
      <section class="hero-section">
        <div class="hero-content">
          <h1 class="hero-title">ğŸ“¦ Ø·Ù„Ø¨Ø§ØªÙŠ</h1>
          <p class="hero-subtitle">ØªØªØ¨Ø¹ Ø¬Ù…ÙŠØ¹ Ø·Ù„Ø¨Ø§ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</p>
        </div>
      </section>
      
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-shopping-bag"></i>
            Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
          </h2>
        </div>
        
        <div id="ordersList" class="loading" style="min-height: 200px;">
          <div class="spinner"></div>
        </div>
      </section>
    `;
    
    document.getElementById('mainContent').innerHTML = content;
    loadUserOrders();
  }

  async function loadUserOrders() {
    try {
      const snapshot = await db.collection('orders')
        .where('userId', '==', currentUser.uid)
        .orderBy('createdAt', 'desc')
        .limit(20)
        .get();
      
      const container = document.getElementById('ordersList');
      
      if (snapshot.empty) {
        container.innerHTML = `
          <div class="text-center" style="padding: 40px 20px;">
            <i class="fas fa-shopping-bag fa-4x mb-3" style="color: #e0e0e0;"></i>
            <h3 class="mb-3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø§Ø¨Ù‚Ø©</h3>
          </div>
        `;
        return;
      }
      
      container.innerHTML = snapshot.docs.map(doc => {
        const order = doc.data();
        return `
          <div style="background: white; border-radius: var(--border-radius-md); padding: 20px; margin-bottom: 15px; border: 1px solid var(--border-color);">
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
              <strong>Ø·Ù„Ø¨ #${doc.id.substring(0, 8)}</strong>
              <span style="color: var(--primary-color);">${order.total?.toFixed(2) || '0'} Ø¬Ù†ÙŠÙ‡</span>
            </div>
            <div style="color: var(--text-light); font-size: 0.9rem;">
              ${order.createdAt?.toDate ? order.createdAt.toDate().toLocaleDateString('ar-EG') : 'ØªØ§Ø±ÙŠØ® ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
            </div>
            <button class="btn btn-outline btn-sm mt-3" onclick="viewOrderDetails('${doc.id}')">
              <i class="fas fa-eye"></i>
              Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
            </button>
          </div>
        `;
      }).join('');
      
    } catch (error) {
      console.error('Error loading orders:', error);
    }
  }

  function openProfile() {
    if (!currentUser) {
      showNotification('Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ', 'warning');
      openLoginModal();
      return;
    }
    
    const modalHTML = `
      <div class="modal-overlay" onclick="closeModal()">
        <div class="modal" onclick="event.stopPropagation()">
          <button class="modal-close" onclick="closeModal()">
            <i class="fas fa-times"></i>
          </button>
          <div class="modal-header">
            <h2 class="modal-title">
              <i class="fas fa-user"></i>
              Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
            </h2>
          </div>
          <div class="modal-body">
            <div style="text-align: center; margin-bottom: 30px;">
              <img src="${userData.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(userData.name)}&background=6B5BFF&color=fff&size=128`}" 
                   alt="${userData.name}"
                   style="width: 100px; height: 100px; border-radius: 50%; border: 4px solid var(--primary-color); margin-bottom: 15px;">
              <h3>${userData.name}</h3>
              <p class="text-muted">${userData.email}</p>
            </div>
            
            <div style="background: rgba(107, 91, 255, 0.05); border-radius: var(--border-radius-md); padding: 20px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span style="color: var(--text-light);">Ø§Ù„Ø¯ÙˆØ±:</span>
                <span style="font-weight: 600;">${userData.role === 'admin' ? 'Ù…Ø¯ÙŠØ±' : 'Ø¹Ù…ÙŠÙ„'}</span>
              </div>
              
              ${userData.phone ? `
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                  <span style="color: var(--text-light);">Ø§Ù„Ù‡Ø§ØªÙ:</span>
                  <span style="font-weight: 600;">${userData.phone}</span>
                </div>
              ` : ''}
              
              ${userData.address ? `
                <div style="display: flex; justify-content: space-between;">
                  <span style="color: var(--text-light);">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</span>
                  <span style="font-weight: 600;">${userData.address}</span>
                </div>
              ` : ''}
            </div>
          </div>
        </div>
      </div>
    `;
    
    document.getElementById('modalsContainer').innerHTML = modalHTML;
  }

  function openNotifications() {
    if (!currentUser) {
      showNotification('Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª', 'warning');
      openLoginModal();
      return;
    }
    
    const modalHTML = `
      <div class="modal-overlay" onclick="closeModal()">
        <div class="modal" onclick="event.stopPropagation()">
          <button class="modal-close" onclick="closeModal()">
            <i class="fas fa-times"></i>
          </button>
          <div class="modal-header">
            <h2 class="modal-title">
              <i class="fas fa-bell"></i>
              Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
            </h2>
          </div>
          <div class="modal-body">
            <div class="text-center" style="padding: 40px 20px;">
              <i class="fas fa-bell-slash fa-3x mb-3" style="color: #e0e0e0;"></i>
              <h3 class="mb-3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
              <p class="text-muted">Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù‡Ù†Ø§ Ø¹Ù†Ø¯ ØªÙˆÙØ±Ù‡Ø§</p>
            </div>
          </div>
        </div>
      </div>
    `;
    
    document.getElementById('modalsContainer').innerHTML = modalHTML;
  }

  async function loadNotifications() {
    if (!currentUser) return;
    
    try {
      const snapshot = await db.collection('notifications')
        .where('userId', '==', currentUser.uid)
        .orderBy('createdAt', 'desc')
        .limit(20)
        .get();
      
      notifications = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      
    } catch (error) {
      console.error('Error loading notifications:', error);
    }
  }

  function notifyAdminsNewUser(userId, userName, userEmail) {
    db.collection('users')
      .where('role', '==', 'admin')
      .get()
      .then(snapshot => {
        snapshot.docs.forEach(doc => {
          db.collection('notifications').add({
            userId: doc.id,
            title: 'Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯',
            message: `ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯: ${userName} (${userEmail})`,
            type: 'new_user',
            read: false,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
        });
      });
  }

  function notifyAdminsNewOrder(orderId, userName, total) {
    db.collection('users')
      .where('role', '==', 'admin')
      .get()
      .then(snapshot => {
        snapshot.docs.forEach(doc => {
          db.collection('notifications').add({
            userId: doc.id,
            title: 'Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯',
            message: `Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† ${userName} Ø¨Ù‚ÙŠÙ…Ø© ${total.toFixed(2)} Ø¬Ù†ÙŠÙ‡`,
            type: 'new_order',
            read: false,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
        });
      });
  }

  console.log('ğŸ‰ ØªØ·Ø¨ÙŠÙ‚ Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„!');
  </script>
</body>
</html>